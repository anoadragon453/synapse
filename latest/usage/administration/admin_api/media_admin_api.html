<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Media - Synapse</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../../../favicon.svg">
        
        
        <link rel="shortcut icon" href="../../../favicon.png">
        
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        
        <link rel="stylesheet" href="../../../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../../../docs-mdbook/book-assets/style.css">
        
        <link rel="stylesheet" href="../../../docs-mdbook/book-assets/remove-nav-buttons.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../../setup/index.html"><strong aria-hidden="true">2.</strong> Setup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../setup/installation.html"><strong aria-hidden="true">2.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../../../setup/postgres.html"><strong aria-hidden="true">2.2.</strong> Using Postgres</a></li><li class="chapter-item expanded "><a href="../../../setup/reverse_proxy.html"><strong aria-hidden="true">2.3.</strong> Configuring a Reverse Proxy</a></li><li class="chapter-item expanded "><a href="../../../setup/turn-howto.html"><strong aria-hidden="true">2.4.</strong> Configuring a Turn Server</a></li><li class="chapter-item expanded "><a href="../../../setup/delegate.html"><strong aria-hidden="true">2.5.</strong> Delegation</a></li></ol></li><li class="chapter-item expanded "><a href="../../../upgrading/index.html"><strong aria-hidden="true">3.</strong> Upgrading</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../upgrading/MSC1711_certificates_FAQ.html"><strong aria-hidden="true">3.1.</strong> Upgrading from pre-Synapse 1.0</a></li></ol></li><li class="chapter-item expanded "><a href="../../../usage/index.html"><strong aria-hidden="true">4.</strong> Usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../usage/federate.html"><strong aria-hidden="true">4.1.</strong> Federation</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/index.html"><strong aria-hidden="true">4.2.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../usage/configuration/sample_config.html"><strong aria-hidden="true">4.2.1.</strong> Sample Configuration Files</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/user_authentication/index.html"><strong aria-hidden="true">4.2.2.</strong> User Authentication</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../usage/configuration/user_authentication/single_sign_on/index.html"><strong aria-hidden="true">4.2.2.1.</strong> Single Sign-On</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../usage/configuration/user_authentication/single_sign_on/openid.html"><strong aria-hidden="true">4.2.2.1.1.</strong> OpenID Connect</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.2.1.2.</strong> SAML</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.2.1.3.</strong> CAS</div></li><li class="chapter-item expanded "><a href="../../../usage/configuration/user_authentication/single_sign_on/sso_mapping_providers.html"><strong aria-hidden="true">4.2.2.1.4.</strong> SSO Mapping Providers</a></li></ol></li><li class="chapter-item expanded "><a href="../../../usage/configuration/user_authentication/password_auth_providers.html"><strong aria-hidden="true">4.2.2.2.</strong> Password Auth Providers</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/user_authentication/jwt.html"><strong aria-hidden="true">4.2.2.3.</strong> JSON Web Tokens</a></li></ol></li><li class="chapter-item expanded "><a href="../../../usage/configuration/CAPTCHA_SETUP.html"><strong aria-hidden="true">4.2.3.</strong> Registration Captcha</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/application_services.html"><strong aria-hidden="true">4.2.4.</strong> Application Services</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/server_notices.html"><strong aria-hidden="true">4.2.5.</strong> Server Notices</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/consent_tracking.html"><strong aria-hidden="true">4.2.6.</strong> Consent Tracking</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/url_previews.html"><strong aria-hidden="true">4.2.7.</strong> URL Previews</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/user_directory.html"><strong aria-hidden="true">4.2.8.</strong> User Directory</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/message_retention_policies.html"><strong aria-hidden="true">4.2.9.</strong> Message Retention Policies</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/pluggable_modules/index.html"><strong aria-hidden="true">4.2.10.</strong> Pluggable Modules</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.10.1.</strong> Third Party Rules</div></li><li class="chapter-item expanded "><a href="../../../usage/configuration/pluggable_modules/spam_checker.html"><strong aria-hidden="true">4.2.10.2.</strong> Spam Checker</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/pluggable_modules/presence_router_module.html"><strong aria-hidden="true">4.2.10.3.</strong> Presence Router</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.10.4.</strong> Writing a Module</div></li></ol></li><li class="chapter-item expanded "><a href="../../../usage/configuration/workers/workers.html"><strong aria-hidden="true">4.2.11.</strong> Workers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../usage/configuration/workers/synctl_workers.html"><strong aria-hidden="true">4.2.11.1.</strong> Using synctl with Workers</a></li><li class="chapter-item expanded "><a href="../../../usage/configuration/workers/systemd-with-workers/index.html"><strong aria-hidden="true">4.2.11.2.</strong> Systemd</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../administration/index.html"><strong aria-hidden="true">4.3.</strong> Administration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/index.html"><strong aria-hidden="true">4.3.1.</strong> Admin API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/account_validity.html"><strong aria-hidden="true">4.3.1.1.</strong> Account Validity</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/delete_group.html"><strong aria-hidden="true">4.3.1.2.</strong> Delete Group</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/event_reports.html"><strong aria-hidden="true">4.3.1.3.</strong> Event Reports</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/media_admin_api.html" class="active"><strong aria-hidden="true">4.3.1.4.</strong> Media</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/purge_history.html"><strong aria-hidden="true">4.3.1.5.</strong> Purge History</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/purge_room.html"><strong aria-hidden="true">4.3.1.6.</strong> Purge Rooms</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/register_api.html"><strong aria-hidden="true">4.3.1.7.</strong> Register Users</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/room_membership.html"><strong aria-hidden="true">4.3.1.8.</strong> Manipulate Room Membership</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/rooms.html"><strong aria-hidden="true">4.3.1.9.</strong> Rooms</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/server_notices.html"><strong aria-hidden="true">4.3.1.10.</strong> Server Notices</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/shutdown_room.html"><strong aria-hidden="true">4.3.1.11.</strong> Shutdown Room</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/statistics.html"><strong aria-hidden="true">4.3.1.12.</strong> Statistics</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/user_admin_api.html"><strong aria-hidden="true">4.3.1.13.</strong> Users</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/admin_api/version_api.html"><strong aria-hidden="true">4.3.1.14.</strong> Server Version</a></li></ol></li><li class="chapter-item expanded "><a href="../../../usage/administration/manhole.html"><strong aria-hidden="true">4.3.2.</strong> Manhole</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/metrics-howto.html"><strong aria-hidden="true">4.3.3.</strong> Monitoring</a></li><li class="chapter-item expanded "><a href="../../../usage/administration/structured_logging.html"><strong aria-hidden="true">4.3.4.</strong> Structured Logging</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.3.5.</strong> Scripts</div></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../development/index.html"><strong aria-hidden="true">5.</strong> Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../development/contributing_guide.html"><strong aria-hidden="true">5.1.</strong> Contributing Guide</a></li><li class="chapter-item expanded "><a href="../../../development/code_style.html"><strong aria-hidden="true">5.2.</strong> Code Style</a></li><li class="chapter-item expanded "><a href="../../../development/git.html"><strong aria-hidden="true">5.3.</strong> Git Usage</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.4.</strong> Testing</div></li><li class="chapter-item expanded "><a href="../../../development/opentracing.html"><strong aria-hidden="true">5.5.</strong> OpenTracing</a></li><li class="chapter-item expanded "><a href="../../../development/synapse_architecture/architecture.html"><strong aria-hidden="true">5.6.</strong> Synapse Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../development/synapse_architecture/log_contexts.html"><strong aria-hidden="true">5.6.1.</strong> Log Contexts</a></li><li class="chapter-item expanded "><a href="../../../development/synapse_architecture/replication.html"><strong aria-hidden="true">5.6.2.</strong> Replication</a></li><li class="chapter-item expanded "><a href="../../../development/synapse_architecture/tcp_replication.html"><strong aria-hidden="true">5.6.3.</strong> TCP Replication</a></li></ol></li><li class="chapter-item expanded "><a href="../../../development/feature_documentation/index.html"><strong aria-hidden="true">5.7.</strong> Feature Documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.7.1.</strong> Single-Sign On</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../development/feature_documentation/single_sign_on/saml.html"><strong aria-hidden="true">5.7.1.1.</strong> SAML</a></li><li class="chapter-item expanded "><a href="../../../development/feature_documentation/single_sign_on/cas.html"><strong aria-hidden="true">5.7.1.2.</strong> CAS</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.7.2.</strong> State Resolution</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../development/feature_documentation/state_resolution/auth_chain_difference_algorithm.html"><strong aria-hidden="true">5.7.2.1.</strong> The Auth Chain Difference Algorithm</a></li></ol></li><li class="chapter-item expanded "><a href="../../../development/feature_documentation/media_repository.html"><strong aria-hidden="true">5.7.3.</strong> Media Repository</a></li><li class="chapter-item expanded "><a href="../../../development/feature_documentation/room_and_user_statistics.html"><strong aria-hidden="true">5.7.4.</strong> Room and User Statistics</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.8.</strong> Scripts</div></li></ol></li><li class="chapter-item expanded "><a href="../../../other/index.html"><strong aria-hidden="true">6.</strong> Other</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../other/deprecation_policy.html"><strong aria-hidden="true">6.1.</strong> Dependency Deprecation Policy</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Synapse</h1>

                    <div class="right-buttons">
                        
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/anoadragon453/synapse" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        
                        <a href="https://github.com/anoadragon453/synapse/edit/develop/src/usage/administration/admin_api/media_admin_api.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc">
                            <nav class="pagetoc"></nav>
                        </div>

                        <h1 id="contents"><a class="header" href="#contents">Contents</a></h1>
<ul>
<li><a href="#querying-media">Querying media</a>
<ul>
<li><a href="#list-all-media-in-a-room">List all media in a room</a></li>
<li><a href="#list-all-media-uploaded-by-a-user">List all media uploaded by a user</a></li>
</ul>
</li>
<li><a href="#quarantine-media">Quarantine media</a>
<ul>
<li><a href="#quarantining-media-by-id">Quarantining media by ID</a></li>
<li><a href="#quarantining-media-in-a-room">Quarantining media in a room</a></li>
<li><a href="#quarantining-all-media-of-a-user">Quarantining all media of a user</a></li>
<li><a href="#protecting-media-from-being-quarantined">Protecting media from being quarantined</a></li>
</ul>
</li>
<li><a href="#delete-local-media">Delete local media</a>
<ul>
<li><a href="#delete-a-specific-local-media">Delete a specific local media</a></li>
<li><a href="#delete-local-media-by-date-or-size">Delete local media by date or size</a></li>
</ul>
</li>
<li><a href="#purge-remote-media-api">Purge Remote Media API</a></li>
</ul>
<h1 id="querying-media"><a class="header" href="#querying-media">Querying media</a></h1>
<p>These APIs allow extracting media information from the homeserver.</p>
<h2 id="list-all-media-in-a-room"><a class="header" href="#list-all-media-in-a-room">List all media in a room</a></h2>
<p>This API gets a list of known media in a room.
However, it only shows media from unencrypted events or rooms.</p>
<p>The API is:</p>
<pre><code>GET /_synapse/admin/v1/room/&lt;room_id&gt;/media
</code></pre>
<p>To use it, you will need to authenticate by providing an <code>access_token</code> for a
server admin: see <a href="README.rst">README.rst</a>.</p>
<p>The API returns a JSON body like the following:</p>
<pre><code class="language-json">{
  &quot;local&quot;: [
    &quot;mxc://localhost/xwvutsrqponmlkjihgfedcba&quot;,
    &quot;mxc://localhost/abcdefghijklmnopqrstuvwx&quot;
  ],
  &quot;remote&quot;: [
    &quot;mxc://matrix.org/xwvutsrqponmlkjihgfedcba&quot;,
    &quot;mxc://matrix.org/abcdefghijklmnopqrstuvwx&quot;
  ]
}
</code></pre>
<h2 id="list-all-media-uploaded-by-a-user"><a class="header" href="#list-all-media-uploaded-by-a-user">List all media uploaded by a user</a></h2>
<p>Listing all media that has been uploaded by a local user can be achieved through
the use of the <a href="user_admin_api.rst#list-media-of-a-user">List media of a user</a>
Admin API.</p>
<h1 id="quarantine-media"><a class="header" href="#quarantine-media">Quarantine media</a></h1>
<p>Quarantining media means that it is marked as inaccessible by users. It applies
to any local media, and any locally-cached copies of remote media.</p>
<p>The media file itself (and any thumbnails) is not deleted from the server.</p>
<h2 id="quarantining-media-by-id"><a class="header" href="#quarantining-media-by-id">Quarantining media by ID</a></h2>
<p>This API quarantines a single piece of local or remote media.</p>
<p>Request:</p>
<pre><code>POST /_synapse/admin/v1/media/quarantine/&lt;server_name&gt;/&lt;media_id&gt;

{}
</code></pre>
<p>Where <code>server_name</code> is in the form of <code>example.org</code>, and <code>media_id</code> is in the
form of <code>abcdefg12345...</code>.</p>
<p>Response:</p>
<pre><code class="language-json">{}
</code></pre>
<h2 id="quarantining-media-in-a-room"><a class="header" href="#quarantining-media-in-a-room">Quarantining media in a room</a></h2>
<p>This API quarantines all local and remote media in a room.</p>
<p>Request:</p>
<pre><code>POST /_synapse/admin/v1/room/&lt;room_id&gt;/media/quarantine

{}
</code></pre>
<p>Where <code>room_id</code> is in the form of <code>!roomid12345:example.org</code>.</p>
<p>Response:</p>
<pre><code class="language-json">{
  &quot;num_quarantined&quot;: 10
}
</code></pre>
<p>The following fields are returned in the JSON response body:</p>
<ul>
<li><code>num_quarantined</code>: integer - The number of media items successfully quarantined</li>
</ul>
<p>Note that there is a legacy endpoint, <code>POST /_synapse/admin/v1/quarantine_media/&lt;room_id&gt;</code>, that operates the same.
However, it is deprecated and may be removed in a future release.</p>
<h2 id="quarantining-all-media-of-a-user"><a class="header" href="#quarantining-all-media-of-a-user">Quarantining all media of a user</a></h2>
<p>This API quarantines all <em>local</em> media that a <em>local</em> user has uploaded. That is to say, if
you would like to quarantine media uploaded by a user on a remote homeserver, you should
instead use one of the other APIs.</p>
<p>Request:</p>
<pre><code>POST /_synapse/admin/v1/user/&lt;user_id&gt;/media/quarantine

{}
</code></pre>
<p>URL Parameters</p>
<ul>
<li><code>user_id</code>: string - User ID in the form of <code>@bob:example.org</code></li>
</ul>
<p>Response:</p>
<pre><code class="language-json">{
  &quot;num_quarantined&quot;: 10
}
</code></pre>
<p>The following fields are returned in the JSON response body:</p>
<ul>
<li><code>num_quarantined</code>: integer - The number of media items successfully quarantined</li>
</ul>
<h2 id="protecting-media-from-being-quarantined"><a class="header" href="#protecting-media-from-being-quarantined">Protecting media from being quarantined</a></h2>
<p>This API protects a single piece of local media from being quarantined using the
above APIs. This is useful for sticker packs and other shared media which you do
not want to get quarantined, especially when
<a href="#quarantining-media-in-a-room">quarantining media in a room</a>.</p>
<p>Request:</p>
<pre><code>POST /_synapse/admin/v1/media/protect/&lt;media_id&gt;

{}
</code></pre>
<p>Where <code>media_id</code> is in the  form of <code>abcdefg12345...</code>.</p>
<p>Response:</p>
<pre><code class="language-json">{}
</code></pre>
<h1 id="delete-local-media"><a class="header" href="#delete-local-media">Delete local media</a></h1>
<p>This API deletes the <em>local</em> media from the disk of your own server.
This includes any local thumbnails and copies of media downloaded from
remote homeservers.
This API will not affect media that has been uploaded to external
media repositories (e.g https://github.com/turt2live/matrix-media-repo/).
See also <a href="#purge-remote-media-api">Purge Remote Media API</a>.</p>
<h2 id="delete-a-specific-local-media"><a class="header" href="#delete-a-specific-local-media">Delete a specific local media</a></h2>
<p>Delete a specific <code>media_id</code>.</p>
<p>Request:</p>
<pre><code>DELETE /_synapse/admin/v1/media/&lt;server_name&gt;/&lt;media_id&gt;

{}
</code></pre>
<p>URL Parameters</p>
<ul>
<li><code>server_name</code>: string - The name of your local server (e.g <code>matrix.org</code>)</li>
<li><code>media_id</code>: string - The ID of the media (e.g <code>abcdefghijklmnopqrstuvwx</code>)</li>
</ul>
<p>Response:</p>
<pre><code class="language-json">{
  &quot;deleted_media&quot;: [
    &quot;abcdefghijklmnopqrstuvwx&quot;
  ],
  &quot;total&quot;: 1
}
</code></pre>
<p>The following fields are returned in the JSON response body:</p>
<ul>
<li><code>deleted_media</code>: an array of strings - List of deleted <code>media_id</code></li>
<li><code>total</code>: integer - Total number of deleted <code>media_id</code></li>
</ul>
<h2 id="delete-local-media-by-date-or-size"><a class="header" href="#delete-local-media-by-date-or-size">Delete local media by date or size</a></h2>
<p>Request:</p>
<pre><code>POST /_synapse/admin/v1/media/&lt;server_name&gt;/delete?before_ts=&lt;before_ts&gt;

{}
</code></pre>
<p>URL Parameters</p>
<ul>
<li><code>server_name</code>: string - The name of your local server (e.g <code>matrix.org</code>).</li>
<li><code>before_ts</code>: string representing a positive integer - Unix timestamp in ms.
Files that were last used before this timestamp will be deleted. It is the timestamp of
last access and not the timestamp creation. </li>
<li><code>size_gt</code>: Optional - string representing a positive integer - Size of the media in bytes.
Files that are larger will be deleted. Defaults to <code>0</code>.</li>
<li><code>keep_profiles</code>: Optional - string representing a boolean - Switch to also delete files
that are still used in image data (e.g user profile, room avatar).
If <code>false</code> these files will be deleted. Defaults to <code>true</code>.</li>
</ul>
<p>Response:</p>
<pre><code class="language-json">{
  &quot;deleted_media&quot;: [
    &quot;abcdefghijklmnopqrstuvwx&quot;,
    &quot;abcdefghijklmnopqrstuvwz&quot;
  ],
  &quot;total&quot;: 2
}
</code></pre>
<p>The following fields are returned in the JSON response body:</p>
<ul>
<li><code>deleted_media</code>: an array of strings - List of deleted <code>media_id</code></li>
<li><code>total</code>: integer - Total number of deleted <code>media_id</code></li>
</ul>
<h1 id="purge-remote-media-api"><a class="header" href="#purge-remote-media-api">Purge Remote Media API</a></h1>
<p>The purge remote media API allows server admins to purge old cached remote media.</p>
<p>The API is:</p>
<pre><code>POST /_synapse/admin/v1/purge_media_cache?before_ts=&lt;unix_timestamp_in_ms&gt;

{}
</code></pre>
<p>URL Parameters</p>
<ul>
<li><code>unix_timestamp_in_ms</code>: string representing a positive integer - Unix timestamp in ms.
All cached media that was last accessed before this timestamp will be removed.</li>
</ul>
<p>Response:</p>
<pre><code class="language-json">{
  &quot;deleted&quot;: 10
}
</code></pre>
<p>The following fields are returned in the JSON response body:</p>
<ul>
<li><code>deleted</code>: integer - The number of media items successfully deleted</li>
</ul>
<p>To use it, you will need to authenticate by providing an <code>access_token</code> for a
server admin: see <a href="README.rst">README.rst</a>.</p>
<p>If the user re-requests purged remote media, synapse will re-request the media
from the originating server.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../../usage/administration/admin_api/event_reports.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../../usage/administration/admin_api/purge_history.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../../usage/administration/admin_api/event_reports.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../../usage/administration/admin_api/purge_history.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../../../docs-mdbook/book-assets/sidebar.js"></script>
        

        

    </body>
</html>
