<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SSO Mapping Providers - Synapse</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="docs/website_files/table-of-contents.css">
        
        <link rel="stylesheet" href="docs/website_files/remove-nav-buttons.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');
                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }
                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction/index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="setup/index.html"><strong aria-hidden="true">2.</strong> Setup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="setup/installation.html"><strong aria-hidden="true">2.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="postgres.html"><strong aria-hidden="true">2.2.</strong> Using Postgres</a></li><li class="chapter-item expanded "><a href="reverse_proxy.html"><strong aria-hidden="true">2.3.</strong> Configuring a Reverse Proxy</a></li><li class="chapter-item expanded "><a href="turn-howto.html"><strong aria-hidden="true">2.4.</strong> Configuring a Turn Server</a></li><li class="chapter-item expanded "><a href="delegate.html"><strong aria-hidden="true">2.5.</strong> Delegation</a></li></ol></li><li class="chapter-item expanded "><a href="upgrading/index.html"><strong aria-hidden="true">3.</strong> Upgrading</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="MSC1711_certificates_FAQ.html"><strong aria-hidden="true">3.1.</strong> Upgrading from pre-Synapse 1.0</a></li></ol></li><li class="chapter-item expanded "><a href="usage/index.html"><strong aria-hidden="true">4.</strong> Usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="federate.html"><strong aria-hidden="true">4.1.</strong> Federation</a></li><li class="chapter-item expanded "><a href="usage/configuration/index.html"><strong aria-hidden="true">4.2.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="usage/configuration/sample_config.html"><strong aria-hidden="true">4.2.1.</strong> Sample Configuration Files</a></li><li class="chapter-item expanded "><a href="usage/configuration/user_authentication/index.html"><strong aria-hidden="true">4.2.2.</strong> User Authentication</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.2.1.</strong> Single-Sign On</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="openid.html"><strong aria-hidden="true">4.2.2.1.1.</strong> OpenID Connect</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.2.1.2.</strong> SAML</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.2.1.3.</strong> CAS</div></li><li class="chapter-item expanded "><a href="sso_mapping_providers.html" class="active"><strong aria-hidden="true">4.2.2.1.4.</strong> SSO Mapping Providers</a></li></ol></li><li class="chapter-item expanded "><a href="password_auth_providers.html"><strong aria-hidden="true">4.2.2.2.</strong> Password Auth Providers</a></li><li class="chapter-item expanded "><a href="jwt.html"><strong aria-hidden="true">4.2.2.3.</strong> JSON Web Tokens</a></li></ol></li><li class="chapter-item expanded "><a href="CAPTCHA_SETUP.html"><strong aria-hidden="true">4.2.3.</strong> Registration Captcha</a></li><li class="chapter-item expanded "><a href="application_services.html"><strong aria-hidden="true">4.2.4.</strong> Application Services</a></li><li class="chapter-item expanded "><a href="server_notices.html"><strong aria-hidden="true">4.2.5.</strong> Server Notices</a></li><li class="chapter-item expanded "><a href="consent_tracking.html"><strong aria-hidden="true">4.2.6.</strong> Consent Tracking</a></li><li class="chapter-item expanded "><a href="url_previews.html"><strong aria-hidden="true">4.2.7.</strong> URL Previews</a></li><li class="chapter-item expanded "><a href="user_directory.html"><strong aria-hidden="true">4.2.8.</strong> User Directory</a></li><li class="chapter-item expanded "><a href="message_retention_policies.html"><strong aria-hidden="true">4.2.9.</strong> Message Retention Policies</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.10.</strong> Pluggable Modules</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.10.1.</strong> Third Party Rules</div></li><li class="chapter-item expanded "><a href="spam_checker.html"><strong aria-hidden="true">4.2.10.2.</strong> Spam Checker</a></li><li class="chapter-item expanded "><a href="presence_router_module.html"><strong aria-hidden="true">4.2.10.3.</strong> Presence Router</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.10.4.</strong> Writing a Module</div></li></ol></li><li class="chapter-item expanded "><a href="workers.html"><strong aria-hidden="true">4.2.11.</strong> Workers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="synctl_workers.html"><strong aria-hidden="true">4.2.11.1.</strong> Using synctl with Workers</a></li><li class="chapter-item expanded "><a href="systemd-with-workers/index.html"><strong aria-hidden="true">4.2.11.2.</strong> Systemd</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="usage/administration/index.html"><strong aria-hidden="true">4.3.</strong> Administration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="admin_api/index.html"><strong aria-hidden="true">4.3.1.</strong> Admin API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="admin_api/account_validity.html"><strong aria-hidden="true">4.3.1.1.</strong> Account Validity</a></li><li class="chapter-item expanded "><a href="admin_api/delete_group.html"><strong aria-hidden="true">4.3.1.2.</strong> Delete Group</a></li><li class="chapter-item expanded "><a href="admin_api/event_reports.html"><strong aria-hidden="true">4.3.1.3.</strong> Event Reports</a></li><li class="chapter-item expanded "><a href="admin_api/media_admin_api.html"><strong aria-hidden="true">4.3.1.4.</strong> Media</a></li><li class="chapter-item expanded "><a href="admin_api/purge_history_api.html"><strong aria-hidden="true">4.3.1.5.</strong> Purge History</a></li><li class="chapter-item expanded "><a href="admin_api/purge_room.html"><strong aria-hidden="true">4.3.1.6.</strong> Purge Rooms</a></li><li class="chapter-item expanded "><a href="admin_api/register_api.html"><strong aria-hidden="true">4.3.1.7.</strong> Register Users</a></li><li class="chapter-item expanded "><a href="admin_api/room_membership.html"><strong aria-hidden="true">4.3.1.8.</strong> Manipulate Room Membership</a></li><li class="chapter-item expanded "><a href="admin_api/rooms.html"><strong aria-hidden="true">4.3.1.9.</strong> Rooms</a></li><li class="chapter-item expanded "><a href="admin_api/server_notices.html"><strong aria-hidden="true">4.3.1.10.</strong> Server Notices</a></li><li class="chapter-item expanded "><a href="admin_api/shutdown_room.html"><strong aria-hidden="true">4.3.1.11.</strong> Shutdown Room</a></li><li class="chapter-item expanded "><a href="admin_api/statistics.html"><strong aria-hidden="true">4.3.1.12.</strong> Statistics</a></li><li class="chapter-item expanded "><a href="admin_api/user_admin_api.html"><strong aria-hidden="true">4.3.1.13.</strong> Users</a></li><li class="chapter-item expanded "><a href="admin_api/version_api.html"><strong aria-hidden="true">4.3.1.14.</strong> Server Version</a></li></ol></li><li class="chapter-item expanded "><a href="manhole.html"><strong aria-hidden="true">4.3.2.</strong> Manhole</a></li><li class="chapter-item expanded "><a href="metrics-howto.html"><strong aria-hidden="true">4.3.3.</strong> Monitoring</a></li><li class="chapter-item expanded "><a href="structured_logging.html"><strong aria-hidden="true">4.3.4.</strong> Structured Logging</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.3.5.</strong> Scripts</div></li></ol></li></ol></li><li class="chapter-item expanded "><a href="development/index.html"><strong aria-hidden="true">5.</strong> Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="development/contributing_guide.html"><strong aria-hidden="true">5.1.</strong> Contributing Guide</a></li><li class="chapter-item expanded "><a href="code_style.html"><strong aria-hidden="true">5.2.</strong> Code Style</a></li><li class="chapter-item expanded "><a href="dev/git.html"><strong aria-hidden="true">5.3.</strong> Git Usage</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.4.</strong> Testing</div></li><li class="chapter-item expanded "><a href="opentracing.html"><strong aria-hidden="true">5.5.</strong> OpenTracing</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.6.</strong> Synapse Architecture</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="log_contexts.html"><strong aria-hidden="true">5.6.1.</strong> Log Contexts</a></li><li class="chapter-item expanded "><a href="replication.html"><strong aria-hidden="true">5.6.2.</strong> Replication</a></li><li class="chapter-item expanded "><a href="tcp_replication.html"><strong aria-hidden="true">5.6.3.</strong> TCP Replication</a></li></ol></li><li class="chapter-item expanded "><a href="development/feature_documentation/index.html"><strong aria-hidden="true">5.7.</strong> Feature Documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.7.1.</strong> Single-Sign On</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="dev/saml.html"><strong aria-hidden="true">5.7.1.1.</strong> SAML</a></li><li class="chapter-item expanded "><a href="dev/cas.html"><strong aria-hidden="true">5.7.1.2.</strong> CAS</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.7.2.</strong> State Resolution</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="auth_chain_difference_algorithm.html"><strong aria-hidden="true">5.7.2.1.</strong> The Auth Chain Difference Algorithm</a></li></ol></li><li class="chapter-item expanded "><a href="media_repository.html"><strong aria-hidden="true">5.7.3.</strong> Media Repository</a></li><li class="chapter-item expanded "><a href="room_and_user_statistics.html"><strong aria-hidden="true">5.7.4.</strong> Room and User Statistics</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.8.</strong> Scripts</div></li></ol></li><li class="chapter-item expanded "><a href="other/index.html"><strong aria-hidden="true">6.</strong> Other</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="deprecation_policy.html"><strong aria-hidden="true">6.1.</strong> Dependency Deprecation Policy</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Synapse</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/matrix-org/synapse" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc">
                            <nav class="pagetoc"></nav>
                        </div>

                        <h1 id="sso-mapping-providers"><a class="header" href="#sso-mapping-providers">SSO Mapping Providers</a></h1>
<p>A mapping provider is a Python class (loaded via a Python module) that
works out how to map attributes of a SSO response to Matrix-specific
user attributes. Details such as user ID localpart, displayname, and even avatar
URLs are all things that can be mapped from talking to a SSO service.</p>
<p>As an example, a SSO service may return the email address
&quot;john.smith@example.com&quot; for a user, whereas Synapse will need to figure out how
to turn that into a displayname when creating a Matrix user for this individual.
It may choose <code>John Smith</code>, or <code>Smith, John [Example.com]</code> or any number of
variations. As each Synapse configuration may want something different, this is
where SAML mapping providers come into play.</p>
<p>SSO mapping providers are currently supported for OpenID and SAML SSO
configurations. Please see the details below for how to implement your own.</p>
<p>It is up to the mapping provider whether the user should be assigned a predefined
Matrix ID based on the SSO attributes, or if the user should be allowed to
choose their own username.</p>
<p>In the first case - where users are automatically allocated a Matrix ID - it is
the responsibility of the mapping provider to normalise the SSO attributes and
map them to a valid Matrix ID. The <a href="https://matrix.org/docs/spec/appendices#user-identifiers">specification for Matrix
IDs</a> has some
information about what is considered valid.</p>
<p>If the mapping provider does not assign a Matrix ID, then Synapse will
automatically serve an HTML page allowing the user to pick their own username.</p>
<p>External mapping providers are provided to Synapse in the form of an external
Python module. You can retrieve this module from <a href="https://pypi.org">PyPI</a> or elsewhere,
but it must be importable via Synapse (e.g. it must be in the same virtualenv
as Synapse). The Synapse config is then modified to point to the mapping provider
(and optionally provide additional configuration for it).</p>
<h2 id="openid-mapping-providers"><a class="header" href="#openid-mapping-providers">OpenID Mapping Providers</a></h2>
<p>The OpenID mapping provider can be customized by editing the
<code>oidc_config.user_mapping_provider.module</code> config option.</p>
<p><code>oidc_config.user_mapping_provider.config</code> allows you to provide custom
configuration options to the module. Check with the module's documentation for
what options it provides (if any). The options listed by default are for the
user mapping provider built in to Synapse. If using a custom module, you should
comment these options out and use those specified by the module instead.</p>
<h3 id="building-a-custom-openid-mapping-provider"><a class="header" href="#building-a-custom-openid-mapping-provider">Building a Custom OpenID Mapping Provider</a></h3>
<p>A custom mapping provider must specify the following methods:</p>
<ul>
<li><code>__init__(self, parsed_config)</code>
<ul>
<li>Arguments:
<ul>
<li><code>parsed_config</code> - A configuration object that is the return value of the
<code>parse_config</code> method. You should set any configuration options needed by
the module here.</li>
</ul>
</li>
</ul>
</li>
<li><code>parse_config(config)</code>
<ul>
<li>This method should have the <code>@staticmethod</code> decoration.</li>
<li>Arguments:
<ul>
<li><code>config</code> - A <code>dict</code> representing the parsed content of the
<code>oidc_config.user_mapping_provider.config</code> homeserver config option.
Runs on homeserver startup. Providers should extract and validate
any option values they need here.</li>
</ul>
</li>
<li>Whatever is returned will be passed back to the user mapping provider module's
<code>__init__</code> method during construction.</li>
</ul>
</li>
<li><code>get_remote_user_id(self, userinfo)</code>
<ul>
<li>Arguments:
<ul>
<li><code>userinfo</code> - A <code>authlib.oidc.core.claims.UserInfo</code> object to extract user
information from.</li>
</ul>
</li>
<li>This method must return a string, which is the unique, immutable identifier
for the user. Commonly the <code>sub</code> claim of the response.</li>
</ul>
</li>
<li><code>map_user_attributes(self, userinfo, token, failures)</code>
<ul>
<li>This method must be async.</li>
<li>Arguments:
<ul>
<li><code>userinfo</code> - A <code>authlib.oidc.core.claims.UserInfo</code> object to extract user
information from.</li>
<li><code>token</code> - A dictionary which includes information necessary to make
further requests to the OpenID provider.</li>
<li><code>failures</code> - An <code>int</code> that represents the amount of times the returned
mxid localpart mapping has failed.  This should be used
to create a deduplicated mxid localpart which should be
returned instead. For example, if this method returns
<code>john.doe</code> as the value of <code>localpart</code> in the returned
dict, and that is already taken on the homeserver, this
method will be called again with the same parameters but
with failures=1. The method should then return a different
<code>localpart</code> value, such as <code>john.doe1</code>.</li>
</ul>
</li>
<li>Returns a dictionary with two keys:
<ul>
<li><code>localpart</code>: A string, used to generate the Matrix ID. If this is
<code>None</code>, the user is prompted to pick their own username. This is only used
during a user's first login. Once a localpart has been associated with a
remote user ID (see <code>get_remote_user_id</code>) it cannot be updated.</li>
<li><code>displayname</code>: An optional string, the display name for the user.</li>
</ul>
</li>
</ul>
</li>
<li><code>get_extra_attributes(self, userinfo, token)</code>
<ul>
<li>
<p>This method must be async.</p>
</li>
<li>
<p>Arguments:</p>
<ul>
<li><code>userinfo</code> - A <code>authlib.oidc.core.claims.UserInfo</code> object to extract user
information from.</li>
<li><code>token</code> - A dictionary which includes information necessary to make
further requests to the OpenID provider.</li>
</ul>
</li>
<li>
<p>Returns a dictionary that is suitable to be serialized to JSON. This
will be returned as part of the response during a successful login.</p>
<p>Note that care should be taken to not overwrite any of the parameters
usually returned as part of the <a href="https://matrix.org/docs/spec/client_server/latest#post-matrix-client-r0-login">login response</a>.</p>
</li>
</ul>
</li>
</ul>
<h3 id="default-openid-mapping-provider"><a class="header" href="#default-openid-mapping-provider">Default OpenID Mapping Provider</a></h3>
<p>Synapse has a built-in OpenID mapping provider if a custom provider isn't
specified in the config. It is located at
<a href="../synapse/handlers/oidc.py"><code>synapse.handlers.oidc.JinjaOidcMappingProvider</code></a>.</p>
<h2 id="saml-mapping-providers"><a class="header" href="#saml-mapping-providers">SAML Mapping Providers</a></h2>
<p>The SAML mapping provider can be customized by editing the
<code>saml2_config.user_mapping_provider.module</code> config option.</p>
<p><code>saml2_config.user_mapping_provider.config</code> allows you to provide custom
configuration options to the module. Check with the module's documentation for
what options it provides (if any). The options listed by default are for the
user mapping provider built in to Synapse. If using a custom module, you should
comment these options out and use those specified by the module instead.</p>
<h3 id="building-a-custom-saml-mapping-provider"><a class="header" href="#building-a-custom-saml-mapping-provider">Building a Custom SAML Mapping Provider</a></h3>
<p>A custom mapping provider must specify the following methods:</p>
<ul>
<li><code>__init__(self, parsed_config, module_api)</code>
<ul>
<li>Arguments:
<ul>
<li><code>parsed_config</code> - A configuration object that is the return value of the
<code>parse_config</code> method. You should set any configuration options needed by
the module here.</li>
<li><code>module_api</code> - a <code>synapse.module_api.ModuleApi</code> object which provides the
stable API available for extension modules.</li>
</ul>
</li>
</ul>
</li>
<li><code>parse_config(config)</code>
<ul>
<li>This method should have the <code>@staticmethod</code> decoration.</li>
<li>Arguments:
<ul>
<li><code>config</code> - A <code>dict</code> representing the parsed content of the
<code>saml_config.user_mapping_provider.config</code> homeserver config option.
Runs on homeserver startup. Providers should extract and validate
any option values they need here.</li>
</ul>
</li>
<li>Whatever is returned will be passed back to the user mapping provider module's
<code>__init__</code> method during construction.</li>
</ul>
</li>
<li><code>get_saml_attributes(config)</code>
<ul>
<li>This method should have the <code>@staticmethod</code> decoration.</li>
<li>Arguments:
<ul>
<li><code>config</code> - A object resulting from a call to <code>parse_config</code>.</li>
</ul>
</li>
<li>Returns a tuple of two sets. The first set equates to the SAML auth
response attributes that are required for the module to function, whereas
the second set consists of those attributes which can be used if available,
but are not necessary.</li>
</ul>
</li>
<li><code>get_remote_user_id(self, saml_response, client_redirect_url)</code>
<ul>
<li>Arguments:
<ul>
<li><code>saml_response</code> - A <code>saml2.response.AuthnResponse</code> object to extract user
information from.</li>
<li><code>client_redirect_url</code> - A string, the URL that the client will be
redirected to.</li>
</ul>
</li>
<li>This method must return a string, which is the unique, immutable identifier
for the user. Commonly the <code>uid</code> claim of the response.</li>
</ul>
</li>
<li><code>saml_response_to_user_attributes(self, saml_response, failures, client_redirect_url)</code>
<ul>
<li>
<p>Arguments:</p>
<ul>
<li><code>saml_response</code> - A <code>saml2.response.AuthnResponse</code> object to extract user
information from.</li>
<li><code>failures</code> - An <code>int</code> that represents the amount of times the returned
mxid localpart mapping has failed.  This should be used
to create a deduplicated mxid localpart which should be
returned instead. For example, if this method returns
<code>john.doe</code> as the value of <code>mxid_localpart</code> in the returned
dict, and that is already taken on the homeserver, this
method will be called again with the same parameters but
with failures=1. The method should then return a different
<code>mxid_localpart</code> value, such as <code>john.doe1</code>.</li>
<li><code>client_redirect_url</code> - A string, the URL that the client will be
redirected to.</li>
</ul>
</li>
<li>
<p>This method must return a dictionary, which will then be used by Synapse
to build a new user. The following keys are allowed:</p>
<ul>
<li><code>mxid_localpart</code> - A string, the mxid localpart of the new user. If this is
<code>None</code>, the user is prompted to pick their own username. This is only used
during a user's first login. Once a localpart has been associated with a
remote user ID (see <code>get_remote_user_id</code>) it cannot be updated.</li>
<li><code>displayname</code> - The displayname of the new user. If not provided, will default to
the value of <code>mxid_localpart</code>.</li>
<li><code>emails</code> - A list of emails for the new user. If not provided, will
default to an empty list.</li>
</ul>
<p>Alternatively it can raise a <code>synapse.api.errors.RedirectException</code> to
redirect the user to another page. This is useful to prompt the user for
additional information, e.g. if you want them to provide their own username.
It is the responsibility of the mapping provider to either redirect back
to <code>client_redirect_url</code> (including any additional information) or to
complete registration using methods from the <code>ModuleApi</code>.</p>
</li>
</ul>
</li>
</ul>
<h3 id="default-saml-mapping-provider"><a class="header" href="#default-saml-mapping-provider">Default SAML Mapping Provider</a></h3>
<p>Synapse has a built-in SAML mapping provider if a custom provider isn't
specified in the config. It is located at
<a href="../synapse/handlers/saml.py"><code>synapse.handlers.saml.DefaultSamlMappingProvider</code></a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="openid.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="password_auth_providers.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="openid.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="password_auth_providers.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="docs/website_files/table-of-contents.js"></script>
        

        

    </body>
</html>